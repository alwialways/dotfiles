# Sidebar Patch --------------------------------------
#set sidebar_delim   = '  │'
set sidebar_visible = yes
set sidebar_width   = 24
color sidebar_new color221 color233

# Sidebar Navigation ---------------------------------
#bind index,pager <down>   sidebar-next
#bind index,pager <up>     sidebar-prev
#bind index,pager <right>  sidebar-open
bind index,pager b sidebar-toggle-visible # b toggles sidebar visibility
set index_format="%4C %Z %?X?A&-? %{%d/%b/%y} %-12.12L %?M?(#%03M)&(%4c)? %?y?(%.20Y) ?%s"
set display_filter="$HOME/.dotfiles/tag-mutt/mutt/local-date.py"

# Status Bar -----------------------------------------
set status_chars  = " *%A"
set status_format = "───[ Folder: %f ]───[%r%m messages%?n? (%n new)?%?d? (%d to delete)?%?t? (%t tagged)? ]───%>─%?p?( %p postponed )?───"

# Header Options -------------------------------------
ignore *                                # ignore all headers
unignore from: to: cc: date: subject:   # show only these
unhdr_order *                           # some distros order things by default
hdr_order from: to: cc: date: subject:  # and in this order

# Account Settings -----------------------------------
#set wait_key = no        # shut up, mutt
#set timeout = 3          # idle time before scanning
#set mail_check = 0       # minimum time between scans
set beep_new              # bell on new mails
#set pipe_decode          # strip headers and eval mimes when piping
#set thorough_search      # strip headers and eval mimes before searching
#unset move               # gmail does that
set delete           # don't ask, just do
unset confirmappend  # don't ask, just do!
set quit             # don't ask, just do!!
set text_flowed=yes # Format-Flowed 

# look and feel
set pager_index_lines = 8
set pager_context     = 5
set pager_stop
set menu_scroll
set smart_wrap
set tilde
unset markers

## Speed up folder switch
set sleep_time = 0
set mbox_type=Maildir
#set imap_check_subscribed

## url view
#macro pager \cu <pipe-entry>'urlview'<enter> 'Follow links with urlview' 
macro pager \Cu "|urlview<enter>" "call urlview to open links"

set folder = "~/Mail"
set spoolfile = "+Gmail/INBOX"
source ~/.mutt/mailboxes

## Not much
#set virtual_spoolfile=yes
#set nm_default_uri="notmuch:///home/arch/Mail" # path to the maildir
#source ~/.mutt/virtualmailboxes
#macro index A "<modify-labels>+archive -unread -inbox\\n" "Archive message"
#macro index c "<change-vfolder>?" "Change to vfolder overview"
#macro index \\\\ "<vfolder-from-query>" "Search mailbox"

# Linux
macro index <F8> \
     "<enter-command>unset wait_key<enter><shell-escape>notmuch-mutt --prompt search<enter><change-folder-readonly>`echo ${XDG_CACHE_HOME:-$HOME/.cache}/notmuch/mutt/results`<enter>" \
     "notmuch: search mail"
macro index <F9> \
     "<enter-command>unset wait_key<enter><pipe-message>notmuch-mutt thread<enter><change-folder-readonly>`echo ${XDG_CACHE_HOME:-$HOME/.cache}/notmuch/mutt/results`<enter><enter-command>set wait_key<enter>" \
     "notmuch: reconstruct thread"
macro index <F6> \
     "<enter-command>unset wait_key<enter><pipe-message>notmuch-mutt tag -inbox<enter>" \
     "notmuch: remove message from inbox"

## Mac
#macro index S \
#  "<enter-command>set my_old_pipe_decode=\$pipe_decode my_old_wait_key=\$wait_key nopipe_decode nowait_key<enter>\
#  <shell-escape>~/Documents/Script/notmuch-mutt -r --prompt search<enter>\
#  <change-folder-readonly>`echo ${XDG_CACHE_HOME:-$HOME/.cache}/notmuch/mutt/results`<enter>\
#  <enter-command>set pipe_decode=\$my_old_pipe_decode wait_key=\$my_old_wait_key<enter>" \
#  "notmuch: search mail"
## format send
#set send_charset="us-ascii:utf-8"

folder-hook 'Gmail/*' 'source ~/.mutt/account_gmail'
folder-hook 'Kernix/*' 'source ~/.mutt/account_kernix'

macro index,pager <F3>  "<change-folder> =Chimie/INBOX<enter>"  "go Chimie"
macro index,pager <F4>  "<change-folder> =Gmail/INBOX<enter>"  "go Gmail"
macro index,pager <F5>  "<change-folder> =Kernix/INBOX<enter>"  "go Kernix"

## Default account
source "~/.mutt/account_gmail"

## Keybindings
bind pager q         exit
bind pager /         search
#bind pager <up>      previous-line
#bind pager <down>    next-line
bind pager k         previous-line
bind pager j         next-line
bind pager gg        top
bind pager G         bottom
bind index gg        first-entry
bind index G         last-entry
bind pager K         previous-undeleted
bind pager J         next-undeleted
bind index K         previous-unread
bind index J         next-unread
bind index,pager R   group-reply
bind index,pager \Cp sidebar-prev
bind index,pager \Cn sidebar-next
bind index,pager \Ci sidebar-open

set mailcap_path	= ~/.mutt/mailcap
alternative_order text/plain text/html
auto_view text/html
auto_view text/calendar application/ics
set markers=no # Delete the + sign on new lines

## Sorting index by thread
set sort=threads #sort by threads
set sort_aux = last-date-received

# Fetch mail shortcut
set print_command="~/Documents/Script/mutt_print.sh"
bind index,pager u bounce-message

# Pre-fills the "From" address when replying to emails, based on the email a account that received the original mail
set reverse_name 
set envelope_from

# Signature
#set signature="~/.mutt/signature"

# Security
source /usr/share/doc/mutt/samples/gpg.rc
#set pgp_use_gpg_agent = yes
set pgp_timeout        = 3600       # how long to cache the pass-phrase
#set crypt_autosign     = yes     # automatically sign all outgoing mail
#set crypt_replyencrypt = yes # automatically encrypt replies to  encrypted messages
set pgp_sign_as        = "B212E65B"   # my Key ID

# Paths
source ~/.mutt/mutt-colors-solarized-dark-16.muttrc
source ~/.mutt/alias
set alias_file = ~/.mutt/alias # where to store aliases
